/* Ofront+ 1.0 -s3 -21 */
#include "SYSTEM.h"


static BYTE ZXWindows_SWTMP, ZXWindows_SWPAP, ZXWindows_SWCLS;


export void ZXWindows_CLS (void);
static void ZXWindows_E (void);
static void ZXWindows_SPRITE (void);


/*============================================================================*/

static void ZXWindows_E (void)
{
	ZXWindows_SWPAP = 1;
	ZXWindows_SWCLS = 55;
	ZXWindows_CLS();
}

void ZXWindows_CLS (void)
{
__asm

; Очистка экрана и атрибутов
;  (SWРAР) - цвет бордюра, 0..7
;  (SWСLS) - код цвета фона

CLS:            LD      A, (_ZXWindows_SWPAP)      ; Берём цвет бордюра
                OUT     (0xFE), A       ; Установим бордюр
                LD      HL, #0x4000
                LD      (HL), L
                LD      DE, #0x4001
                LD      BC, #0x17FF
                LDIR                    ; Чистим экран (пиксельный слой)
                INC     HL
                LD      A, (_ZXWindows_SWCLS)      ; Берём постоянный цвет
                LD      (_ZXWindows_SWTMP), A  ; И устанавливаем им временный цвет
                LD      (HL), A
                INC     DE
                LD      BC, #0x2FF
                LDIR                    ; Чистим экран (атрибутный слой) постоянным цветом
                LD      HL, #DATA_95FC
                LD      DE, #0
                LD      BC, #0x820
                JP      _ZXWindows_SPRITE

DATA_95FC: .DB 0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA
           .DB 0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA
           .DB 0x55,0x03,0x1B,0x18,0xDD,0x00,0x55,0x00,0x06,0x75,0x20,0x00,0x55,0x00,0x0D,0x9C
           .DB 0x98,0x00,0x55,0x00,0x64,0x54,0x8C,0x00,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55
           .DB 0xAA,0x02,0xA8,0xA9,0x49,0x00,0xAA,0x00,0x05,0x47,0x50,0x00,0xAA,0x00,0x15,0x49
           .DB 0x54,0x00,0xAA,0x00,0x54,0x55,0x54,0x00,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA
           .DB 0x55,0x03,0x3B,0x29,0xC9,0x80,0x55,0x00,0x05,0x75,0x50,0x00,0x55,0x00,0x1D,0x89
           .DB 0x58,0x00,0x55,0x00,0x66,0x49,0x54,0x00,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55
           .DB 0xAA,0x02,0x28,0xA9,0x49,0x40,0xAA,0x00,0x05,0x45,0x50,0x00,0xAA,0x00,0x15,0x49
           .DB 0x50,0x00,0xAA,0x00,0x55,0x55,0x54,0x00,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA
           .DB 0x55,0x02,0x2B,0x7D,0x49,0x80,0x55,0x00,0x06,0x75,0x20,0x00,0x55,0x00,0x15,0x88
           .DB 0x90,0x00,0x55,0x00,0x66,0x54,0xBE,0x00,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55
           .DB 0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA
           .DB 0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0x00,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA
           .DB 0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55
           .DB 0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55

__endasm;}

/*----------------------------------------------------------------------------*/
static void ZXWindows_SPRITE (void)
{
}


export void *ZXWindows__init (void)
{
	__DEFMOD;
	__REGMOD("ZXWindows", 0);
	__REGCMD("CLS", ZXWindows_CLS);
/* BEGIN */
	__ENDMOD;
}
